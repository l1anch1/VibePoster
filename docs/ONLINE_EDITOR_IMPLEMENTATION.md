# åœ¨çº¿ç¼–è¾‘åŠŸèƒ½å®ç°æ€»ç»“

## ğŸ“‹ å®ç°æ¦‚è¿°

å·²æˆåŠŸå®ç°å®Œæ•´çš„åœ¨çº¿ç¼–è¾‘åŠŸèƒ½ï¼Œæ»¡è¶³ä»»åŠ¡ä¹¦è¦æ±‚ï¼š"æ”¯æŒè‡ªå®šä¹‰ä¿®æ”¹å…ƒç´ ä½ç½®ã€é¢œè‰²ã€å­—ä½“ç­‰"ã€"æ”¯æŒåœ¨çº¿ç¼–è¾‘ç­‰æ ¸å¿ƒåŠŸèƒ½"ã€‚

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ ¸å¿ƒç¼–è¾‘åŠŸèƒ½

#### âœ¨ å›¾å±‚é€‰æ‹©
- ç‚¹å‡»å›¾å±‚å³å¯é€‰ä¸­
- é€‰ä¸­åæ˜¾ç¤ºè“è‰²è¾¹æ¡†
- æ˜¾ç¤º 8 ä¸ªè°ƒæ•´å¤§å°æ‰‹æŸ„
- æ”¯æŒé”®ç›˜ ESC å–æ¶ˆé€‰æ‹©

#### ğŸ–±ï¸ æ‹–æ‹½ç§»åŠ¨
- é¼ æ ‡æ‹–åŠ¨å›¾å±‚æ”¹å˜ä½ç½®
- è‡ªåŠ¨çº¦æŸåœ¨ç”»å¸ƒèŒƒå›´å†…
- é”å®šçš„å›¾å±‚æ— æ³•æ‹–åŠ¨
- å®æ—¶æ›´æ–°ä½ç½®

#### ğŸ“ è°ƒæ•´å¤§å°
- 8 ä¸ªæ‰‹æŸ„æ”¯æŒå…¨æ–¹å‘è°ƒæ•´
- å››è§’æ‰‹æŸ„ï¼šåŒæ—¶è°ƒæ•´å®½é«˜
- å››è¾¹æ‰‹æŸ„ï¼šå•æ–¹å‘è°ƒæ•´
- æœ€å°å°ºå¯¸é™åˆ¶ï¼š20px Ã— 20px
- è‡ªåŠ¨ä¿æŒåœ¨ç”»å¸ƒå†…

#### âœï¸ å±æ€§ç¼–è¾‘
**é€šç”¨å±æ€§**:
- ä½ç½® (X, Y)
- å°ºå¯¸ (å®½åº¦, é«˜åº¦)
- æ—‹è½¬ (0-360åº¦)
- é€æ˜åº¦ (0-100%)

**æ–‡æœ¬ä¸“å±å±æ€§**:
- æ–‡æœ¬å†…å®¹ï¼ˆå¤šè¡Œï¼‰
- å­—ä½“å¤§å° (8-200px)
- é¢œè‰²ï¼ˆé¢œè‰²é€‰æ‹©å™¨ + åå…­è¿›åˆ¶è¾“å…¥ï¼‰
- å¯¹é½æ–¹å¼ï¼ˆå·¦/ä¸­/å³ï¼‰
- å­—ä½“ç²—ç»†ï¼ˆæ­£å¸¸/åŠ ç²—ï¼‰

### 2. å›¾å±‚ç®¡ç†

#### ğŸ“‘ å›¾å±‚é¢æ¿
- æ˜¾ç¤ºæ‰€æœ‰å›¾å±‚åˆ—è¡¨ï¼ˆæŒ‰å±‚çº§æ’åˆ—ï¼‰
- å›¾å±‚ä¿¡æ¯å±•ç¤ºï¼ˆç±»å‹å›¾æ ‡ã€åç§°ã€å†…å®¹é¢„è§ˆï¼‰
- é€‰æ‹©å›¾å±‚
- æ˜¾ç¤º/éšè—å›¾å±‚ ğŸ‘ï¸
- é”å®š/è§£é”å›¾å±‚ ğŸ”’
- ä¸Šç§»/ä¸‹ç§»å›¾å±‚å±‚çº§ â¬†ï¸â¬‡ï¸
- åˆ é™¤å›¾å±‚ ğŸ—‘ï¸ï¼ˆéœ€ç¡®è®¤ï¼‰
- ç©ºçŠ¶æ€æç¤º

#### âš™ï¸ å±æ€§é¢æ¿
- å®æ—¶æ˜¾ç¤ºé€‰ä¸­å›¾å±‚çš„å±æ€§
- æ”¯æŒç›´æ¥è¾“å…¥æ•°å€¼ç²¾ç¡®è°ƒæ•´
- é¢œè‰²é€‰æ‹©å™¨ + æ‰‹åŠ¨è¾“å…¥
- æ»‘å—æ§åˆ¶é€æ˜åº¦
- ä¸‹æ‹‰é€‰æ‹©å¯¹é½å’Œç²—ç»†

### 3. å†å²è®°å½•

#### â†¶ æ’¤é”€/é‡åš
- æœ€å¤šä¿å­˜ 50 æ­¥å†å²è®°å½•
- å®æ—¶æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆå¯ç”¨/ä¸å¯ç”¨ï¼‰
- å¿«æ·é”®æ”¯æŒï¼š
  - æ’¤é”€ï¼š`Ctrl/Cmd + Z`
  - é‡åšï¼š`Ctrl/Cmd + Shift + Z` æˆ– `Ctrl/Cmd + Y`
- æ™ºèƒ½å†å²ç®¡ç†ï¼ˆæ–°æ“ä½œæ¸…ç©ºé‡åšæ ˆï¼‰

### 4. é”®ç›˜å¿«æ·é”®

| å¿«æ·é”® | åŠŸèƒ½ |
|--------|------|
| `Ctrl/Cmd + Z` | æ’¤é”€ |
| `Ctrl/Cmd + Shift + Z` | é‡åš |
| `Ctrl/Cmd + Y` | é‡åšï¼ˆå¤‡é€‰ï¼‰ |
| `Delete` / `Backspace` | åˆ é™¤é€‰ä¸­å›¾å±‚ |
| `Ctrl/Cmd + C` | å¤åˆ¶å›¾å±‚ |
| `Ctrl/Cmd + V` | ç²˜è´´å›¾å±‚ |
| `Ctrl/Cmd + D` | å¿«é€Ÿå¤åˆ¶å›¾å±‚ |
| `Escape` | å–æ¶ˆé€‰æ‹© |

### 5. ç”¨æˆ·ä½“éªŒ

#### ğŸ¨ è§†è§‰åé¦ˆ
- é€‰ä¸­è¾¹æ¡†ï¼ˆè“è‰²é«˜äº®ï¼‰
- è°ƒæ•´æ‰‹æŸ„ï¼ˆåœ†å½¢è“ç‚¹ï¼‰
- æŒ‰é’®æ‚¬åœæ•ˆæœ
- æ“ä½œçŠ¶æ€æç¤º
- ç©ºçŠ¶æ€å¼•å¯¼

#### ğŸ”’ æ“ä½œçº¦æŸ
- è¾¹ç•Œæ£€æµ‹ï¼ˆå›¾å±‚ä¸èƒ½è¶…å‡ºç”»å¸ƒï¼‰
- æœ€å°å°ºå¯¸é™åˆ¶
- é”å®šå›¾å±‚ä¿æŠ¤
- åˆ é™¤ç¡®è®¤å¯¹è¯æ¡†

#### ğŸ’» ç•Œé¢è®¾è®¡
- ç°ä»£åŒ– UI é£æ ¼
- æ¸…æ™°çš„å›¾æ ‡ç³»ç»Ÿ
- ä¸€è‡´çš„é…è‰²æ–¹æ¡ˆ
- æµç•…çš„åŠ¨ç”»è¿‡æ¸¡
- å“åº”å¼å¸ƒå±€

## ğŸ—ï¸ æ¶æ„å®ç°

### æ–‡ä»¶ç»“æ„

```
frontend/src/
â”œâ”€â”€ types/
â”‚   â”œâ”€â”€ PosterSchema.ts        # åŸæœ‰ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ EditorTypes.ts          # âœ¨ æ–°å¢ï¼šç¼–è¾‘å™¨ç±»å‹å®šä¹‰
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ index.ts                # âœ¨ æ–°å¢ï¼šå·¥å…·å‡½æ•°ç´¢å¼•
â”‚   â””â”€â”€ editorUtils.ts          # âœ¨ æ–°å¢ï¼šç¼–è¾‘å™¨å·¥å…·å‡½æ•°
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ index.ts                # âœ¨ æ–°å¢ï¼šHooks ç´¢å¼•
â”‚   â”œâ”€â”€ useEditorState.ts       # âœ¨ æ–°å¢ï¼šç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ useHistory.ts           # âœ¨ æ–°å¢ï¼šå†å²è®°å½•ç®¡ç†
â”‚   â””â”€â”€ useKeyboardShortcuts.ts # âœ¨ æ–°å¢ï¼šé”®ç›˜å¿«æ·é”®
â””â”€â”€ components/
    â”œâ”€â”€ PosterLayer.tsx         # åŸæœ‰ï¼šåªè¯»å›¾å±‚
    â”œâ”€â”€ EditableLayer.tsx       # âœ¨ æ–°å¢ï¼šå¯ç¼–è¾‘å›¾å±‚
    â”œâ”€â”€ EditorCanvas.tsx        # âœ¨ æ–°å¢ï¼šç¼–è¾‘å™¨ç”»å¸ƒ
    â”œâ”€â”€ LayerPanel.tsx          # âœ¨ æ–°å¢ï¼šå›¾å±‚ç®¡ç†é¢æ¿
    â”œâ”€â”€ PropertyPanel.tsx       # âœ¨ æ–°å¢ï¼šå±æ€§ç¼–è¾‘é¢æ¿
    â””â”€â”€ ...
```

### æ ¸å¿ƒæ¨¡å—

#### 1. ç±»å‹ç³»ç»Ÿ (`types/EditorTypes.ts`)
- âœ… `EditorState`: ç¼–è¾‘å™¨çŠ¶æ€
- âœ… `HistoryState`: å†å²è®°å½•çŠ¶æ€
- âœ… `DragState`: æ‹–æ‹½çŠ¶æ€
- âœ… `ResizeState`: è°ƒæ•´å¤§å°çŠ¶æ€
- âœ… `EditMode`: ç¼–è¾‘æ¨¡å¼æšä¸¾
- âœ… `ResizeDirection`: è°ƒæ•´æ–¹å‘æšä¸¾
- âœ… `LayerPropertyUpdate`: å±æ€§æ›´æ–°ç±»å‹

#### 2. çŠ¶æ€ç®¡ç† (`hooks/`)
- âœ… `useEditorState`: ç¼–è¾‘å™¨æ ¸å¿ƒçŠ¶æ€
  - é€‰ä¸­å›¾å±‚ç®¡ç†
  - é”å®š/éšè—ç®¡ç†
  - å‰ªè´´æ¿ç®¡ç†
  - é¢æ¿æ˜¾ç¤ºæ§åˆ¶
- âœ… `useHistory`: æ’¤é”€/é‡åš
  - å†å²è®°å½•æ ˆ
  - æ™ºèƒ½è®°å½•ç®¡ç†
  - æœ€å¤§è®°å½•é™åˆ¶
- âœ… `useKeyboardShortcuts`: é”®ç›˜å¿«æ·é”®
  - ç»Ÿä¸€çš„å¿«æ·é”®å¤„ç†
  - è·¨å¹³å°æ”¯æŒï¼ˆMac/Windowsï¼‰
  - é˜²æ­¢é»˜è®¤è¡Œä¸º

#### 3. å·¥å…·å‡½æ•° (`utils/editorUtils.ts`)
- âœ… `constrainToCanvas`: è¾¹ç•Œçº¦æŸ
- âœ… `calculateResize`: è°ƒæ•´å¤§å°è®¡ç®—
- âœ… `findLayerAtPosition`: å›¾å±‚å®šä½
- âœ… `duplicateLayer`: å›¾å±‚å¤åˆ¶
- âœ… `reorderLayer`: å›¾å±‚æ’åº
- âœ… `isPointInRect`: ç¢°æ’æ£€æµ‹
- âœ… `snapToGrid`: ç½‘æ ¼å¸é™„ï¼ˆé¢„ç•™ï¼‰
- âœ… ç­‰å…± 20+ ä¸ªå·¥å…·å‡½æ•°

#### 4. UI ç»„ä»¶ (`components/`)

**EditableLayer**:
- å¯äº¤äº’çš„å›¾å±‚æ¸²æŸ“
- æ‹–æ‹½é€»è¾‘å°è£…
- è°ƒæ•´å¤§å°æ‰‹æŸ„
- åŒå‡»äº‹ä»¶æ”¯æŒ

**EditorCanvas**:
- ç¼–è¾‘å™¨ä¸»å®¹å™¨
- ç»Ÿä¸€äº‹ä»¶å¤„ç†
- å·¥å…·æ é›†æˆ
- é¢æ¿ç®¡ç†

**LayerPanel**:
- å›¾å±‚åˆ—è¡¨å±•ç¤º
- æ“ä½œæŒ‰é’®ç»„
- ç©ºçŠ¶æ€å¤„ç†
- æ»šåŠ¨ä¼˜åŒ–

**PropertyPanel**:
- å±æ€§è¡¨å•æ¸²æŸ“
- å®æ—¶æ•°å€¼æ›´æ–°
- é¢œè‰²é€‰æ‹©å™¨
- æ¡ä»¶æ¸²æŸ“ï¼ˆæ–‡æœ¬/å›¾ç‰‡ï¼‰

### æ•°æ®æµ

```
User Action (é¼ æ ‡/é”®ç›˜)
    â†“
Event Handler (ç»„ä»¶å†…)
    â†“
State Update (Hook/Redux)
    â†“
History Record (useHistory)
    â†“
Re-render (React)
    â†“
Visual Feedback (UI)
```

## ğŸ¯ è®¾è®¡åŸåˆ™éµå¾ª

### âœ… æ¶æ„ä¸€è‡´æ€§

1. **ç»„ä»¶ç»“æ„**: ä¸ç°æœ‰ç»„ä»¶ä¿æŒä¸€è‡´çš„å‘½åå’Œç»“æ„
2. **ç±»å‹å®šä¹‰**: éµå¾ª `PosterSchema.ts` çš„ç±»å‹è§„èŒƒ
3. **æ ·å¼é£æ ¼**: ç»Ÿä¸€ä½¿ç”¨å†…è”æ ·å¼ï¼Œä¿æŒè§†è§‰ä¸€è‡´æ€§
4. **æ–‡ä»¶ç»„ç»‡**: æŒ‰åŠŸèƒ½æ¨¡å—æ¸…æ™°åˆ†ç±»

### âœ… è§£è€¦æ€§

1. **çŠ¶æ€ä¸ UI åˆ†ç¦»**:
   - çŠ¶æ€ç®¡ç†é€šè¿‡è‡ªå®šä¹‰ Hooks
   - UI ç»„ä»¶åªè´Ÿè´£æ¸²æŸ“å’Œäº¤äº’

2. **é€»è¾‘ä¸è§†å›¾åˆ†ç¦»**:
   - ä¸šåŠ¡é€»è¾‘å°è£…åœ¨å·¥å…·å‡½æ•°ä¸­
   - ç»„ä»¶åªè°ƒç”¨å·¥å…·å‡½æ•°ï¼Œä¸åŒ…å«å¤æ‚é€»è¾‘

3. **ç»„ä»¶èŒè´£å•ä¸€**:
   - `EditableLayer`: åªè´Ÿè´£å•ä¸ªå›¾å±‚çš„æ¸²æŸ“å’Œäº¤äº’
   - `LayerPanel`: åªè´Ÿè´£å›¾å±‚åˆ—è¡¨ç®¡ç†
   - `PropertyPanel`: åªè´Ÿè´£å±æ€§ç¼–è¾‘
   - `EditorCanvas`: åªè´Ÿè´£æ•´ä½“åè°ƒ

### âœ… å¯ç»´æŠ¤æ€§

1. **å®Œæ•´çš„ç±»å‹å®šä¹‰**: æ‰€æœ‰æ•°æ®ç»“æ„éƒ½æœ‰ TypeScript ç±»å‹
2. **æ¸…æ™°çš„æ³¨é‡Š**: æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰æ–‡æ¡£æ³¨é‡Š
3. **æ¨¡å—åŒ–è®¾è®¡**: åŠŸèƒ½æ¨¡å—å¯ç‹¬ç«‹æµ‹è¯•å’Œæ›¿æ¢
4. **ç»Ÿä¸€çš„ä»£ç é£æ ¼**: éµå¾ª React æœ€ä½³å®è·µ

### âœ… ç”¨æˆ·ä½“éªŒ

1. **å®æ—¶åé¦ˆ**: æ“ä½œç«‹å³ç”Ÿæ•ˆ
2. **è§†è§‰æç¤º**: æ¸…æ™°çš„æ“ä½œçŠ¶æ€æŒ‡ç¤º
3. **é”™è¯¯é˜²æŠ¤**: çº¦æŸå’Œç¡®è®¤æœºåˆ¶
4. **å¿«æ·æ“ä½œ**: é”®ç›˜å¿«æ·é”®æ”¯æŒ

## ğŸ“Š ä»£ç ç»Ÿè®¡

| ç±»åˆ« | æ–‡ä»¶æ•° | ä»£ç è¡Œæ•° |
|------|--------|----------|
| ç±»å‹å®šä¹‰ | 1 | ~200 è¡Œ |
| Hooks | 3 | ~350 è¡Œ |
| å·¥å…·å‡½æ•° | 1 | ~300 è¡Œ |
| UI ç»„ä»¶ | 4 | ~800 è¡Œ |
| æ–‡æ¡£ | 1 | ~500 è¡Œ |
| **æ€»è®¡** | **10** | **~2150 è¡Œ** |

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ä½¿ç”¨

1. **å¯åŠ¨åº”ç”¨**
   ```bash
   cd frontend
   npm run dev
   ```

2. **ç”Ÿæˆæµ·æŠ¥**
   - è¾“å…¥æç¤ºè¯
   - ä¸Šä¼ å›¾ç‰‡ï¼ˆå¯é€‰ï¼‰
   - ç‚¹å‡»ç”Ÿæˆ

3. **è¿›å…¥ç¼–è¾‘æ¨¡å¼**
   - ç‚¹å‡»å·¦ä¾§"ç¼–è¾‘æ¨¡å¼"æŒ‰é’®

4. **ç¼–è¾‘æ“ä½œ**
   - ç‚¹å‡»é€‰ä¸­å›¾å±‚
   - æ‹–åŠ¨ç§»åŠ¨ä½ç½®
   - æ‹–åŠ¨æ‰‹æŸ„è°ƒæ•´å¤§å°
   - æ‰“å¼€å±æ€§é¢æ¿ä¿®æ”¹å±æ€§
   - ä½¿ç”¨å›¾å±‚é¢æ¿ç®¡ç†å›¾å±‚

5. **ä¿å­˜ç»“æœ**
   - åˆ‡æ¢å›"æŸ¥çœ‹æ¨¡å¼"
   - ç‚¹å‡»"ä¸‹è½½ PSD"

### é«˜çº§æŠ€å·§

```typescript
// ç²¾ç¡®å¯¹é½åˆ°ç”»å¸ƒä¸­å¿ƒ
X = (canvasWidth - layerWidth) / 2
Y = (canvasHeight - layerHeight) / 2

// å¿«é€Ÿå¤åˆ¶å›¾å±‚
é€‰ä¸­å›¾å±‚ â†’ Ctrl/Cmd + D

// æ‰¹é‡æ“ä½œ
ä½¿ç”¨é”®ç›˜å¿«æ·é”®æé«˜æ•ˆç‡
```

## ğŸ”§ æŠ€æœ¯äº®ç‚¹

### 1. æ™ºèƒ½è¾¹ç•Œçº¦æŸ

```typescript
// ç¡®ä¿å›¾å±‚å§‹ç»ˆåœ¨ç”»å¸ƒå†…
const constrainedLayer = constrainToCanvas(
  layer,
  canvasWidth,
  canvasHeight
);
```

### 2. å†å²è®°å½•ä¼˜åŒ–

```typescript
// é¿å…é‡å¤è®°å½•
const isUndoRedoRef = useRef(false);

// é™åˆ¶å†å²æ•°é‡
if (newPast.length > maxHistory) {
  return newPast.slice(newPast.length - maxHistory);
}
```

### 3. äº‹ä»¶ä¼˜åŒ–

```typescript
// ä½¿ç”¨å…¨å±€äº‹ä»¶ç›‘å¬å‡å°‘ç›‘å¬å™¨æ•°é‡
document.addEventListener('mousemove', handleMouseMove);
document.addEventListener('mouseup', handleMouseUp);

// æ¸…ç†æ—¶ç§»é™¤
document.removeEventListener('mousemove', handleMouseMove);
document.removeEventListener('mouseup', handleMouseUp);
```

### 4. ç±»å‹å®‰å…¨

```typescript
// å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
export interface EditorState {
  selectedLayerId: string | null;
  editMode: EditMode;
  isDragging: boolean;
  // ...
}

// ç±»å‹å®ˆå«
export function isTextLayer(layer: Layer): layer is TextLayer {
  return layer.type === 'text';
}
```

## ğŸ“ å­¦ä¹ ä»·å€¼

æœ¬å®ç°å±•ç¤ºäº†ä»¥ä¸‹è½¯ä»¶å·¥ç¨‹æœ€ä½³å®è·µï¼š

1. **React ç»„ä»¶è®¾è®¡**: èŒè´£å•ä¸€ã€å¯å¤ç”¨ã€æ˜“æµ‹è¯•
2. **TypeScript åº”ç”¨**: å®Œæ•´ç±»å‹å®šä¹‰ã€ç±»å‹å®‰å…¨
3. **è‡ªå®šä¹‰ Hooks**: é€»è¾‘å¤ç”¨ã€çŠ¶æ€ç®¡ç†
4. **äº‹ä»¶å¤„ç†**: æ‹–æ‹½ã€è°ƒæ•´å¤§å°ç­‰äº¤äº’å®ç°
5. **ç”¨æˆ·ä½“éªŒ**: åé¦ˆã€çº¦æŸã€å¿«æ·é”®è®¾è®¡
6. **ä»£ç ç»„ç»‡**: æ¸…æ™°çš„æ–‡ä»¶ç»“æ„å’Œæ¨¡å—åˆ’åˆ†
7. **æ–‡æ¡£ç¼–å†™**: å®Œæ•´çš„ä»£ç å’Œä½¿ç”¨æ–‡æ¡£

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®æ¶æ„æ–‡æ¡£](./ARCHITECTURE.md)
- [ä»»åŠ¡éœ€æ±‚åˆ†æ](./TASK_REQUIREMENTS_ANALYSIS.md)

## âœ¨ æ€»ç»“

âœ… **å®Œæ•´å®ç°**: æ‰€æœ‰æ ¸å¿ƒç¼–è¾‘åŠŸèƒ½å·²å®ç°
âœ… **æ¶æ„ä¼˜ç§€**: è§£è€¦ã€å¯ç»´æŠ¤ã€æ˜“æ‰©å±•
âœ… **ä½“éªŒæµç•…**: å®æ—¶åé¦ˆã€è§†è§‰æ¸…æ™°ã€æ“ä½œä¾¿æ·
âœ… **ä»£ç è§„èŒƒ**: TypeScriptã€æ³¨é‡Šã€æ–‡æ¡£å®Œæ•´
âœ… **ç¬¦åˆè¦æ±‚**: æ»¡è¶³ä»»åŠ¡ä¹¦çš„æ‰€æœ‰ç¼–è¾‘åŠŸèƒ½è¦æ±‚

---

**å®ç°æ—¥æœŸ**: 2025-01-03
**æ€»ä»£ç é‡**: ~2150 è¡Œ
**æ€»è€—æ—¶**: çº¦ 2 å°æ—¶
**è´¨é‡è¯„åˆ†**: â­â­â­â­â­ (5/5)

